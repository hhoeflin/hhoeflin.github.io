

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../..">
      
      
        <link rel="next" href="../using_make/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Devtools with spack - Holger Hoefling's homepage</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

  

  

  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#development-environment-using-spack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Holger Hoefling&#39;s homepage" class="md-header__button md-logo" aria-label="Holger Hoefling's homepage" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Holger Hoefling's homepage
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Devtools with spack
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Holger Hoefling&#39;s homepage" class="md-nav__button md-logo" aria-label="Holger Hoefling's homepage" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Holger Hoefling's homepage
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          devtools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          devtools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Devtools with spack
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Devtools with spack
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    Basic setup
  </a>
  
    <nav class="md-nav" aria-label="Basic setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites-and-installation" class="md-nav__link">
    Prerequisites and installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-the-applications" class="md-nav__link">
    Specifying the applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    Configuration options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-modules" class="md-nav__link">
    Environment modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-the-installation" class="md-nav__link">
    Performing the installation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-your-own-packages" class="md-nav__link">
    Adding your own packages
  </a>
  
    <nav class="md-nav" aria-label="Adding your own packages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-new-packages" class="md-nav__link">
    Creating new packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjusting-existing-packages" class="md-nav__link">
    Adjusting existing packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-customizations" class="md-nav__link">
    Other customizations
  </a>
  
    <nav class="md-nav" aria-label="Other customizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-special-compilers" class="md-nav__link">
    Using special compilers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-docker-containers" class="md-nav__link">
    Creating Docker containers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-processing-the-modules" class="md-nav__link">
    Post-processing the modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    Other
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#package-permissions" class="md-nav__link">
    Package permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../using_make/" class="md-nav__link">
        Devtools with make
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../using_nix/" class="md-nav__link">
        Devtools with nix
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bash_in_docker/" class="md-nav__link">
        Bash in Docker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../publications/" class="md-nav__link">
        Publications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://hhoeflin.github.io/online-cv/" target=_blank"" class="md-nav__link">
        CV
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://www.linkedin.com/in/holger-h%C3%B6fling-96590552/?originalSubdomain=ch" target=_blank"" class="md-nav__link">
        Linkedin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Packages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          mkreports
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          mkreports
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hhoeflin/mkreports" target=_blank"" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://hhoeflin.github.io/mkreports/" target=_blank"" class="md-nav__link">
        Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://pypi.org/project/mkreports/" target=_blank"" class="md-nav__link">
        Pypi
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          hdf5r
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          hdf5r
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://hhoeflin.github.io/hdf5r" target=_blank"" class="md-nav__link">
        Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/hhoeflin/hdf5r" target=_blank"" class="md-nav__link">
        Source code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://cran.r-project.org/web/packages/hdf5r/index.html" target=_blank"" class="md-nav__link">
        CRAN
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    Basic setup
  </a>
  
    <nav class="md-nav" aria-label="Basic setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites-and-installation" class="md-nav__link">
    Prerequisites and installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-the-applications" class="md-nav__link">
    Specifying the applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    Configuration options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-modules" class="md-nav__link">
    Environment modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-the-installation" class="md-nav__link">
    Performing the installation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-your-own-packages" class="md-nav__link">
    Adding your own packages
  </a>
  
    <nav class="md-nav" aria-label="Adding your own packages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-new-packages" class="md-nav__link">
    Creating new packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjusting-existing-packages" class="md-nav__link">
    Adjusting existing packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-customizations" class="md-nav__link">
    Other customizations
  </a>
  
    <nav class="md-nav" aria-label="Other customizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-special-compilers" class="md-nav__link">
    Using special compilers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-docker-containers" class="md-nav__link">
    Creating Docker containers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-processing-the-modules" class="md-nav__link">
    Post-processing the modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    Other
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#package-permissions" class="md-nav__link">
    Package permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="development-environment-using-spack">Development environment using Spack</h1>
<p><em>August 2023</em></p>
<p>In this post we will look at another package manager
that can be used in situations where the user doesn't have root --
<a href="https://github.com/spack/spack">Spack</a>.</p>
<p><code>Spack</code> is actually a Python-based software installation 
solution developed for HPC environments (similar to other projects 
in this space such as <a href="https://easybuild.io/">EasyBuild</a>). As such
it is very powerful and has many options that are necessary for the 
purpose, such as the ability to pick the exact compiler, processor
architecture, various configuration options etc. It is also capable
of installing several versions of a software at the same time 
as well as make them available using environment modules. </p>
<p>Installation procedures for packages are written as Python-classes
that implement methods that control how an installation is performed
and how the modules are being created. For many scientific applications
as well as common tools packages already exist.</p>
<p>A lot of information about <code>Spack</code> can be found in the
<a href="https://spack.readthedocs.io/en/latest/index.html">manual</a> but
also the <a href="https://spack-tutorial.readthedocs.io/en/latest/">tutorials</a>.
It also has a nice section about using it as a 
<a href="https://spack.readthedocs.io/en/latest/replace_conda_homebrew.html">homebrew/conda replacement</a>,
which is similar to what we intend to do. So this is a good read as well.</p>
<h2 id="basic-setup">Basic setup</h2>
<h3 id="prerequisites-and-installation">Prerequisites and installation</h3>
<p>The system requirements are pretty lightweight and should be easily satisfied.
A complete list can be found 
<a href="https://spack.readthedocs.io/en/latest/getting_started.html#system-prerequisites">here</a>.</p>
<p>Most of these should come pre-installed on a common OS, or for Debian and RHEL systems,
installation commands for the necessary prerequisites are provided.</p>
<p>For the installation of Spack itself, we just follow along in
<a href="https://spack.readthedocs.io/en/latest/getting_started.html#installation">Getting started - Installation</a>.</p>
<p>It in general has a lot of very detailed descriptions on what you can do with the tool, 
but we don't need anything beyond the basic:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>-c<span class="w"> </span>feature.manyFiles<span class="o">=</span><span class="nb">true</span><span class="w"> </span>https://github.com/spack/spack.git
.<span class="w"> </span>spack/share/spack/setup-env.sh
</code></pre></div>
<p>and we are ready to get started with specifying the environment we want to have.</p>
<h3 id="specifying-the-applications">Specifying the applications</h3>
<p>As Spack comes with a large number of existing applications, we will create an environment
using those as much as possible for now, before we later look into writing our own packages.</p>
<p>The way we describe such an <code>environment</code> is explained in
<a href="https://spack.readthedocs.io/en/latest/environments.html">Environments</a>.</p>
<p>For now, we just specify an environment with only tmux 
as the only application (to make testing it out faster).</p>
<div class="highlight"><span class="filename">spack.yaml</span><pre><span></span><code><span class="nt">spack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">specs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmux</span>
<span class="w">    </span><span class="nt">concretizer</span><span class="p">:</span>
<span class="w">        </span><span class="nt">unify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">when_possible</span>
</code></pre></div>
<h3 id="configuration-options">Configuration options</h3>
<p>For us, we want to install the software in a our home directory in <code>~/.local/spack</code>. For
this we specify a configuration yaml file with the necessary settings. The 
list of possible settings is at 
<a href="https://spack.readthedocs.io/en/latest/config_yaml.html">config.yaml</a>.</p>
<p>For us, at first we simply create a new <code>config.yaml</code> file in our local directory
and specify the desired install location. However do look at the default configuration
as there are many other potentially interesting settings to try out.</p>
<div class="highlight"><span class="filename">config.yaml</span><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">install_tree</span><span class="p">:</span>
<span class="w">        </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.local/spack</span>
</code></pre></div>
<p>Here note how the top-level entry is <code>config</code>. This is done so that all different
<code>Spack</code> configuration files are easily composable. </p>
<h3 id="environment-modules">Environment modules</h3>
<p>In our case, we only want to create a module hierarchy with a prefix of <code>home</code> to 
distinguish it from the other module that we have in our system. We also don't need
any hashes at the end of our modules and only want them for the <code>lmod</code> system, not
<code>tcl</code>. Therefore we set </p>
<div class="highlight"><span class="filename">modules.yaml</span><pre><span></span><code><span class="nt">modules</span><span class="p">:</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span>
<span class="w">        </span><span class="nt">enable</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lmod</span>
<span class="w">        </span><span class="nt">roots</span><span class="p">:</span>
<span class="w">            </span><span class="nt">lmod</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;~/.local/spack_modules&quot;</span>
<span class="w">        </span><span class="nt">lmod</span><span class="p">:</span>
<span class="w">            </span><span class="nt">hash_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">            </span><span class="nt">projections</span><span class="p">:</span>
<span class="w">                </span><span class="nt">all</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;home/{name}/{version}&quot;</span>
<span class="w">            </span><span class="nt">all</span><span class="p">:</span>
<span class="w">                </span><span class="nt">conflict</span><span class="p">:</span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{name}&quot;</span>
</code></pre></div>
<p>This way it will be easy later to also inject our own custom modules into the 
hierarchy that has some adaptations, such as the setting of aliases etc.</p>
<h3 id="performing-the-installation">Performing the installation</h3>
<p>The installation consists of two separate steps -  the concretization which
determines all the applications and their dependencies to install - as well as the
actual installation. This is done by calling <code>spack concretize</code> (possibly with -f to
force a re-evaluation) and <code>spack install</code>.</p>
<p>Note that using the <code>--config-scope</code> or <code>-C</code> switch (right after the <code>spack</code> command)
we can define custom scopes, such as settings that differ by the location we want to 
install our environment in (see 
<a href="https://spack.readthedocs.io/en/latest/configuration.html#configuration-scopes">Custom scopes</a>).
With <code>-e</code> we specify the location of the relevant environment (the directory that contains 
the <code>spack.yaml</code> file).</p>
<p>When we are in the directory with our file, we can do something like:
<div class="highlight"><pre><span></span><code>spack<span class="w"> </span>-C<span class="w"> </span>.<span class="w"> </span>-e<span class="w"> </span>.<span class="w"> </span>concretize<span class="w"> </span>-f<span class="w"> </span>
spack<span class="w"> </span>-C<span class="w"> </span>.<span class="w"> </span>-e<span class="w"> </span>.<span class="w"> </span>install
</code></pre></div></p>
<h2 id="adding-your-own-packages">Adding your own packages</h2>
<p>Instead of adding packages to the default location, we specify our own
package repository location for this build. To do this, we need to specify
a custom <code>repos.yaml</code> (see also
<a href="https://spack.readthedocs.io/en/latest/repositories.html#repos-yaml">repos.yaml</a>).</p>
<div class="highlight"><span class="filename">repos.yaml</span><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;absolute repo_dir&gt;</span>
</code></pre></div>
<p>Using this we can now use a created repository with our special packages
(which we can keep in a separate git repository).</p>
<h3 id="creating-new-packages">Creating new packages</h3>
<p>First the repository needs to be created. This can be done with the </p>
<p><div class="highlight"><pre><span></span><code>spack<span class="w"> </span>repo<span class="w"> </span>create
</code></pre></div>
command (see also 
<a href="https://spack.readthedocs.io/en/latest/repositories.html#spack-repo-create">spack repo create</a>).</p>
<p>In this new folder, under <code>packages</code>, create a folder with the name of the 
package and inside a <code>package.py</code> file. There are many examples in the 
builtin repository under <code>&lt;spack_dir&gt;/var/spack/repos/builtin</code>. For example
creating a package for <code>mambaforge</code> is easy using the <code>conda</code> package
as an example. Usually, the best starting point is to pick an existing
recipe using the same build-system and to work from there.</p>
<h3 id="adjusting-existing-packages">Adjusting existing packages</h3>
<p>In certain situations it can also be wanted to adjust an already existing package. 
In this case, in order to retain all the upstream adjustements, we can directly
<a href="https://groups.google.com/g/spack/c/yeceTzEdq5w/m/lP1AXcuHCwAJ">inherit packages</a></p>
<h2 id="other-customizations">Other customizations</h2>
<h3 id="using-special-compilers">Using special compilers</h3>
<p>In an HPC environment with older OSes (such as CentOS 7), it may
be necessary to use compilers that are installed and provided using modules.</p>
<p>Spack also allows you to specify other compilers, even if environment
modules are needed to use them. For more on this see
<a href="https://spack.readthedocs.io/en/latest/getting_started.html#compiler-configuration">Compiler configuration</a>.</p>
<h3 id="creating-docker-containers">Creating Docker containers</h3>
<p>An additional nice feature of <em>Spack</em> is its ability to create docker as well
as singularity containers for existing environments 
(see <a href="https://spack.readthedocs.io/en/latest/containers.html">container images</a>).</p>
<p>Using this recipe it is really easy to create a custom docker container for a number
of different linux operating systems. It is then of course also an option to 
copy the compiled binaries out of the container so that they don't have to be compiled
from scratch every time you need to set up a development environment. </p>
<h2 id="post-processing-the-modules">Post-processing the modules</h2>
<p>In the current way that modules are being created by Spack, it does not directly
support modules that need to call scripts or need to set shell-functions. Therefore
in there cases we need to perform a post-processing.</p>
<p>There are basically 2 options how to handle this. The first option is to
append additional script statements to existing modules. The disadvantage of this
is that during a module refresh, these changes would be overwritten.</p>
<p>The second approach is to provide additional modules that are custom-made and provide
the necessary steps to set shell functions or read scripts. Contrary to the first
approach, this would not be overwritten during a refresh, however now a different module
has to be loaded to achieve full functionality.</p>
<h2 id="summary">Summary</h2>
<p>With some minor adjustments, Spack is a very good tool and can be used to create custom development
environments. The only issue is the lack of complete configurability of the environment
modules, but this can easily be worked around.</p>
<h2 id="other">Other</h2>
<h3 id="package-permissions">Package permissions</h3>
<p>In order to set the package permissions so that we can't accidentially
change things, one can follow the instructions at 
<a href="https://spack.readthedocs.io/en/latest/build_settings.html#package-permissions">Package permissions</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>